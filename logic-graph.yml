schema: 1
plugins:
  - ./plugins/bh_veritas_plugins
nodes:
  - id: Article
    type: artifact
    description: "The main article in Markdown."
    value: article_blackhole_inevitable_en.md

  - id: PythonCalc
    type: artifact
    description: "Python script that calculates the singularity timeline."
    value: get_phi_years.py

  - id: LeanProject
    type: artifact
    description: "Lean project that formalizes the core mathematical claims."
    value: .

  - id: GrowthPlot
    type: artifact
    value: viz/growth_curves.png

  - id: RobustPlot
    type: artifact
    value: viz/robust_recal.png

  - id: DropletPlot
    type: artifact
    value: viz/info_droplet.png

  # New node: table and sensitivity verification
  - id: SensitivityCheck
    type: artifact
    value: plugins/bh_veritas_plugins/checks.py

  - id: StorageEconomics
    type: artifact
    value: scripts/storage_simple.py


  
  - id: SilenceFlow
    type: artifact
    description: "Flowchart showing all paths lead to silence."
    value: build/artifacts/silence_flow.png

  - id: SensitivityTR
    type: artifact
    description: "Sensitivity of t(r) as r â†’ 1+."
    value: build/artifacts/sensitivity_tr.png

  - id: CleanMarkdown
    type: artifact
    description: "Clean markdown version without Veritas tags."
    value: build/artifacts/article_blackhole_inevitable_clean.md

  - id: PDFArticle
    type: artifact
    description: "PDF version of the article compiled from LaTeX."
    value: build/artifacts/article_blackhole_inevitable.pdf

  - id: PandocTool
    type: artifact
    description: "Pandoc installation check."
    value: .

  - id: CleanArtifacts
    type: artifact
    description: "Clean old artifacts before regeneration."
    value: build/artifacts

edges:
  # Cleanup phase - run first
  - from: Article
    to: CleanArtifacts
    obligation: bh_cleanup_artifacts

  # Main processing
  - from: CleanArtifacts
    to: PythonCalc
    obligation: bh_python_timeline_check
    meta:
      expected_years: 192

  - from: Article
    to: LeanProject
    obligation: bh_lean_proof_check

  # Generate visualizations after cleanup
  - from: CleanArtifacts
    to: GrowthPlot
    obligation: bh_generate_growth_plot

  - from: CleanArtifacts
    to: RobustPlot
    obligation: bh_generate_robust_plot

  - from: CleanArtifacts
    to: DropletPlot
    obligation: bh_generate_droplet_plot

  - from: CleanArtifacts
    to: SilenceFlow
    obligation: bh_generate_silence_flow

  - from: CleanArtifacts
    to: SensitivityTR
    obligation: bh_generate_sensitivity_plot

  # Check plots exist after generation
  - from: GrowthPlot
    to: PythonCalc
    obligation: growth_curve_png_check

  - from: SensitivityTR
    to: PythonCalc
    obligation: sens_tr_png_check

  # Verify that all quantitative and sensitivity tables match code
  - from: Article
    to: SensitivityCheck
    obligation: article_table_check

  - from: Article
    to: StorageEconomics
    obligation: storage_simple_check



  # Centralization energy inequality
  - from: Article
    to: PythonCalc
    obligation: centralization_energy_check

  # Silence flow chart
  - from: Article
    to: SilenceFlow
    obligation: silence_flow_png_check

  # Value substitution first
  - from: Article
    to: CleanMarkdown
    obligation: bh_markdown_fill

  # Clean markdown compilation after value substitution
  - from: CleanMarkdown
    to: CleanMarkdown
    obligation: bh_clean_markdown_compile

  # Deterministic value checks (after fill, before PDF)
  - from: Article
    to: Article
    obligation: values_resolved_check

  - from: CleanMarkdown
    to: CleanMarkdown
    obligation: clean_markdown_no_tags_check

  - from: Article
    to: StorageEconomics
    obligation: storage_simple_content_check

  - from: Article
    to: PythonCalc
    obligation: values_consistency_check

  # PDF compilation
  - from: PandocTool
    to: PDFArticle
    obligation: bh_pandoc_check

  - from: CleanMarkdown
    to: PDFArticle
    obligation: bh_latex_pdf_compile

 